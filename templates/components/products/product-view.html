<!--
  Fresh, Tailwind-ready Product Page Template
  - Minimal legacy classes
  - Semantic HTML
  - Tailwind utility classes for layout, spacing, and typography
  - Clear section comments for maintainability
-->
<main class="container mx-auto px-4 py-8">
  <!-- Product Title & Banner -->
  <header class="mb-6">
    <h1 class="text-3xl font-bold mb-2" {{#if schema}}itemprop="name"{{/if}}>{{product.title}}</h1>
    {{{region name="pdp-banner-image"}}}
  </header>

  <!-- Main Grid: Images (left), Details (right) -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Product Images -->
    <section class="mb-8 md:mb-0">
      {{#if product.images.length}}
        <figure>
          {{> components/common/responsive-img image=product.main_image class="w-full rounded-lg shadow" fallback_size=theme_settings.product_size lazyload=theme_settings.lazyload_mode default_image=theme_settings.default_image_product otherAttributes="data-main-image" }}
        </figure>
        <!-- Thumbnails or carousel can go here -->
      {{/if}}
      {{#if product.videos.list.length}}
        <div class="mt-4">
          {{> components/products/videos product.videos}}
        </div>
      {{/if}}
    </section>

    <!-- Product Details & Options -->
    <aside class="sticky top-8 self-start">
      <!-- Brand & Price -->
      <div class="mb-4">
        {{#if product.brand}}
          <div class="text-sm text-gray-500 mb-1">
            <a href="{{product.brand.url}}" class="hover:underline">{{product.brand.name}}</a>
          </div>
        {{/if}}
        <div class="text-2xl font-semibold text-primary mb-2">
          {{#or customer (if theme_settings.restrict_to_login '!==' true)}}
            {{> components/products/price price=product.price schema_org=schema}}
          {{else}}
            {{> components/common/login-for-pricing}}
          {{/or}}
        </div>
      </div>

      <!-- Product Options -->
      <form class="space-y-4" method="post" action="{{product.cart_url}}" enctype="multipart/form-data" data-cart-item-add>
        <input type="hidden" name="action" value="add">
        <input type="hidden" name="product_id" value="{{product.id}}"/>
        <div data-product-option-change>
          {{#each product.options}}
            {{{dynamicComponent 'components/products/options'}}}
          {{/each}}
        </div>
        <!-- Quantity & Add to Cart -->
        <div class="flex items-center gap-4 mt-4">
          {{#if theme_settings.show_product_quantity_box}}
            <input class="w-20 border rounded px-2 py-1" id="qty[]" name="qty[]" type="tel" value="{{#if product.min_purchase_quantity}}{{product.min_purchase_quantity}}{{else}}1{{/if}}" min="1" pattern="[0-9]*" aria-live="polite">
          {{/if}}
          <button type="submit" class="btn btn-primary px-6 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition">
            {{#if product.pre_order}}{{lang 'products.pre_order'}}{{else}}{{lang 'products.add_to_cart'}}{{/if}}
          </button>
        </div>
      </form>
      <!-- Stock, SKU, and Info -->
      <div class="mt-6 text-sm text-gray-600">
        {{#if product.stock_level}}
          <div>{{lang 'products.current_stock'}}: <span>{{product.stock_level}}</span></div>
        {{/if}}
        {{#if product.sku}}
          <div>SKU: <span>{{product.sku}}</span></div>
        {{/if}}
        {{#if product.upc}}
          <div>UPC: <span>{{product.upc}}</span></div>
        {{/if}}
      </div>
      <!-- Ratings & Reviews Link -->
      <div class="mt-4">
        {{#if settings.show_product_rating}}
          {{> components/products/ratings rating=product.rating}}
          {{#if product.num_reviews '>' 0}}
            <a href="#product-reviews" class="text-blue-600 hover:underline ml-2">({{product.num_reviews}} reviews)</a>
          {{/if}}
        {{/if}}
      </div>
    </aside>
  </div>

  <!-- Description & Tabs -->
  <section class="mt-10 prose max-w-none" {{#if schema}}itemprop="description"{{/if}}>
    {{> components/products/description-tabs}}
  </section>

  <!-- Specs Table (if present) -->
  {{#contains (toLowerCase (join (pluck product.custom_fields 'name') ',')) 'spec|'}}
    <section class="mt-10">
      <h2 class="text-xl font-bold mb-2">Product Specs</h2>
      <div class="bg-gray-50 rounded p-4">
        {{#each product.custom_fields}}
          {{#contains (toLowerCase name) "spec|"}}
            <div class="mb-2">
              <span class="font-semibold">{{trim (last (split name '|'))}}:</span>
              {{#contains (toLowerCase value) "link|"}}
                <a href="{{trim (last (split value '|'))}}" class="text-blue-600 hover:underline ml-1">{{lookup (split value '|') 1}}</a>
              {{else}}
                <span class="ml-1">{{value}}</span>
              {{/contains}}
            </div>
          {{/contains}}
        {{/each}}
      </div>
    </section>
  {{/contains}}

  <!-- Reviews -->
  <section id="product-reviews" class="mt-10">
    {{> components/products/reviews reviews=product.reviews product=product urls=urls}}
  </section>
</main>

<!-- Modals and Regions (if needed) -->
{{{region name="pdp-description"}}}
{{#or product.custom_fields (if name '===' '__pdp-modal-title') (if name '===' '__pdp-modal-image') (if name '===' '__pdp-modal-text')}}
  <div id="pdp-modal" class="modal modal--large pdp-modal" data-reveal>
    <div class="modal-header pdp-modal__header">
      {{#filter product.custom_fields '__pdp-modal-title' property='name'}}
        <h2 class="modal-header-title pdp-modal__title">{{value}}</h2>
      {{/filter}}
      <a href="#" class="modal-close" aria-label="{{lang 'common.close'}}" role="button">
        <span aria-hidden="true">&#215;</span>
      </a>
    </div>
    <div class="modal-body">
      {{#filter product.custom_fields '__pdp-modal-image' property='name'}}
        <img class="lazyload" data-src="{{cdn (get 'string' (concat (concat 'webdav:/img/pdp_modal/'value)''))}}" src="{{cdn 'img/loading.svg'}}">
      {{/filter}}
      {{#filter product.custom_fields '__pdp-modal-text' property='name'}}
        <p class="pdp-modal__text">{{value}}</p>
      {{/filter}}
    </div>
  </div>
{{/or}}

